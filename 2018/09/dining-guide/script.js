var geojson = {
  type: "FeatureCollection",
  features: [
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.14591879999999,39.9496727]
      },
      properties: {
        title: "Menagerie",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-philly-coffee-shops",
        address:"18 S 3rd Street"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.14473009999999,39.9535536]
      },
      properties: {
        title: "Cafe Ole",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-philly-coffee-shops",
        address:"147 N 3rd Street"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1406512,39.9677286]
      },
      properties: {
        title: "One Shot Cafe",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-philly-coffee-shops",
        address:"217 W George Street"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1573883,39.941923]
      },
      properties: {
        title: "Chapterhouse Cafe",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-philly-coffee-shops",
        address:"620 S 9th Street"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1718436,40.034015]
      },
      properties: {
        title: "Uncle Bobbie's",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-philly-coffee-shops",
        address:"5445 Germantown Avenue"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1563166,39.954249]
      },
      properties: {
        title: "Asia Crafts",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-chinatown-planned-philadephia",
        address:"124 N 10th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1562938,39.9548153]
      },
      properties: {
        title: "Ting Wong",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-chinatown-planned-philadephia",
        address:"138 N 10th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.156041,39.953863]
      },
      properties: {
        title: "KC Pastries",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-chinatown-planned-philadephia",
        address:"109 N 10th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.155964,39.9559225]
      },
      properties: {
        title: "Mr. Wish",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-chinatown-planned-philadephia",
        address:"216 N 10th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1594066,39.9531914]
      },
      properties: {
        title: "Reading Terminal",
        url: "https://www.34st.com/article/2018/09/reading-terminal-roundup-dont-miss-these-8-eateries-america-food-halls-famous-philadelphia",
        address:"51 N 12th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.16687329999999,39.9502275]
      },
      properties: {
        title: "Hungry Pigeon",
        url: "https://www.34st.com/article/2018/09/your-life-as-a-line-cook-hungry-pigeon-philadelphia-best-restaurant",
        address:"1526 Sansom St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1404232,39.9671493]
      },
      properties: {
        title: "Chalaco's",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-zovinar-khrimian-chalaco-peruvian-ceviche-pisco",
        address:"1030 N 2nd St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.138391,39.969505]
      },
      properties: {
        title: "Cadence",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-cadence-philadelphia-food-south-kensington-fishtown",
        address:"161 W Girard Ave"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1439592,39.9494184]
      },
      properties: {
        title: "Vista Peru",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-vista-peru-philadelphia-restaurants",
        address:"20 S 2nd St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1628263,39.9301148]
      },
      properties: {
        title: "Redcrest Fried Chicken",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-daniel-bulpitt-redcrest-friend-chicken",
        address:"1525 S 11th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1632139,39.9284176]
      },
      properties: {
        title: "Mike's BBQ",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-mikes-bbq-southern-hospitality-11th-street-brisket-ribs-cheesesteak",
        address:"1703 S 11th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1779537,39.9488052]
      },
      properties: {
        title: "Trattoria Carina",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-eliana-doft-trattoria-carina",
        address:"2201 Spruce St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.171175,39.939514]
      },
      properties: {
        title: "L'Anima",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-emily-schwartz-lanima",
        address:"1001 S 17th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1695409,39.9493777]
      },
      properties: {
        title: "The Finch",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-spice-finch-hailey-noh",
        address:"220 S 17th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1665541,39.9502251]
      },
      properties: {
        title: "Oyster House",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-oyster-house-philadelphia-food-shellfish",
        address:"1516 Sansom St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1579469,39.9463052]
      },
      properties: {
        title: "Kanella Grill",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-angie-lin-kanella-grill",
        address:"1001 Spruce St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.0554792,40.0620871]
      },
      properties: {
        title: "Lipkin's Bakery",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-caroline-riise-lipkins-bakery",
        address:"8013 Castor Ave"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.147583,39.9488411]
      },
      properties: {
        title: "Chez Ben",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-chez-ben-french-food-philadelphia",
        address:"400 Chestnut St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.169897,39.9523973]
      },
      properties: {
        title: "Harper's Garden",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-harpers-garden-old-city-food-philadelphia",
        address:"31 S 18th St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1643311,39.9630572]
      },
      properties: {
        title: "Heffe Taco",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-heffe-tacos-philadelphia-mexican-food",
        address:"1543 Spring Garden St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1474808,39.9409542]
      },
      properties: {
        title: "Ngon Ngon",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-ngon-ngon-philadelphia-food",
        address:"615 S 3rd St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1765402,39.9510946]
      },
      properties: {
        title: "Talk",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-paige-fishman-talk",
        address:"2121 Walnut St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1668733,39.9502275]
      },
      properties: {
        title: "The Rooster",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-the-rooster-annabelle-williams",
        address:"1526 Sansom St"
      }
    },
    {
      type: "Feature",
      geometry: {
        type: "Point",
        coordinates: [-75.1569322,39.955723]
      },
      properties: {
        title: "Hop Sing Laundromat",
        url: "https://www.34st.com/article/2018/09/dining-guide-fall-2018-hop-sing-laundromat-philadelphia",
        address:"1029 Race St"
      }
    }
  ]
};

const popups = [];

mapboxgl.accessToken = 'pk.eyJ1IjoiZHB3ZWJkZXYiLCJhIjoiY2pmYmN2dDB4MWNoYjRlcTdjM2Y3bGpzZyJ9.1m44PhD4VmqEhKhI4FhPKA';
const map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/dpwebdev/cjfbcjxzi69w52rk936tb9lyu',
  center: [-75.1684066,39.9551914],
  zoom: 13,
  scrollZoom: false
});

map.addControl(new mapboxgl.NavigationControl());

// populate map
map.on('load', () => {
  map.addSource('data', {
    type: 'geojson',
    data: geojson
  });

  map.addLayer({
    id: 'restaurants',
    type: 'circle',
    paint: {
      "circle-color": 'rgb(232,75,59)'
    },
    source: 'data'
  });

  // add listeners for popups when clicking on point
  map.on('click', 'restaurants', e => {
    const coordinates = e.features[0].geometry.coordinates.slice();
    const prop = e.features[0].properties;
    const text = `<h4>${prop.title}</h4><p class="address">${prop.address}</p><a href=${prop.url} target="_blank">Read more »</a>`;


    popups.push(new mapboxgl.Popup().setLngLat(coordinates).setHTML(text).addTo(map));
  });

  // change the cursor to a pointer when the mouse is over the current layer
  map.on('mouseenter', name, () => {
    map.getCanvas().style.cursor = 'pointer';
  });

  // change it back to a pointer when it leaves.
  map.on('mouseleave', name, () => {
    map.getCanvas().style.cursor = '';
  });
});

// add restaurants to sidebar
for (let i in geojson.features) {
  const prop = geojson.features[i].properties;

  const listing = listings.appendChild(document.createElement('div'));
  listing.className = 'item';
  listing.position = i;

  const title = listing.appendChild(document.createElement('h6'));
  title.className = 'title';
  title.innerHTML = prop.title;

  const details = listing.appendChild(document.createElement('div'));
  details.innerHTML = `<p class="address">${prop.address}</p>`;

  // add click event listener for listings
  listing.addEventListener('click', function(e) {
    const curr = geojson.features[this.position];
    const prop = curr.properties;
    const text = `<h4>${prop.title}</h4><p class="address">${prop.address}</p><a href=${prop.url} target="_blank">Read more »</a>`;
    const coordinates = curr.geometry.coordinates;

    // clear popups so we only have one on the map at once
    popups.forEach(el => {
      el.remove();
    });

    map.setCenter(coordinates, 16);
    popups.push(new mapboxgl.Popup().setLngLat(coordinates).setHTML(text).addTo(map));
  });
}
