<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Love Notes 2018 | The DP</title>

  <meta property="og:title" content="Love Notes 2018 | The DP">
  <meta property="og:image" content="https://s3.amazonaws.com/media.dpn/57107_lovenotesnewf.jpg">
  <meta property="og:description" content="Love Notes 2018">
  <meta property="og:type" content="article">
  <meta property="og:url" content="http://projects.thedp.com/2018/02/valentines/lovenotes">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Love Notes 2018 | The DP">
  <meta name="twitter:image" content="https://s3.amazonaws.com/media.dpn/57107_lovenotesnewf.jpg">
  <meta name="twitter:description" content="Love Notes 2018">
  <meta name="twitter:url" content="http://projects.thedp.com/2018/02/valentines/lovenotes">
  <meta name="twitter:site" content="@dailypenn">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">
  <link rel="stylesheet" href="./main.css">

  <script src="https://use.typekit.net/psa2uuo.js"></script>

  <script>try{Typekit.load({ async: true });}catch(e){}</script>
</script>
</head>
<body>
  <script>
  window.fbAsyncInit = function() {
    FB.init({
      appId            : '1042075185814231',
      autoLogAppEvents : true,
      xfbml            : true,
      version          : 'v2.12'
    });
  };

  (function(d, s, id){
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) {return;}
    js = d.createElement(s); js.id = id;
    js.src = "https://connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="container">
  <h1>Love Notes</h1>
  <div class="container">
    <div class="hidden-sm-down">
      <div id='div-gpt-ad-1487027697233-1'>
      </div>
    </div>
    <div class="hidden-md-up">
      <div id='div-gpt-ad-1487027697233-2'>
      </div>
    </div>
  </div>
  <br>
  <div class="row">
    <div class="col-sm-4 col-sm-push-4">
      <div class="input-group stylish-input-group">
        <input type="text" class="form-control" placeholder="Search" id="search">
        <span class="input-group-addon" id="search-icon">
          <img src="search.svg">
        </span>
      </div>
    </div>
  </div>

</div>
<div class="container">
  <div class="row" id="lovenotes">
  </div>

</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/async/2.1.4/async.min.js" charset="utf-8"></script>
<script type="text/javascript">
var NOTES;

var renderNotes = function() {
  notesList = $('#lovenotes')

  for (var note in NOTES) {
    var curNote = NOTES[note];
    notesList.append(
      '<div class="square">' +
      '<div class="content">' +
      '<div class="table">' +
      '<div class="table-cell">' +
      curNote[0] + '<br>' +
      `<a onclick="shareFb('${curNote[0]}')"><img src='facebook.svg'> Share </a>` +
      '</ul>' +
      '</div>' +
      '</div>' +
      '</div>'
    );
  }
}

$(document).ready(function() {
  var csv = $.get('./notes.csv', function( data ) {
    NOTES = $.csv.toArrays(data);
    renderNotes();

    $("#search").on('change keydown paste input', function(evt){
      console.log("in this loop");
      var searchText = $("#search").val().toLowerCase();
      if (searchText.length == 0) {
        $('.square').each(function(index, el) { $(el).show(); });
      }

      if (evt.which == 13 || evt.keyCode == 13) {
        async.each($('.square'), function(note, err) {
          var text = $(note).find('.table-cell')[0];
          if (text.innerHTML.toLowerCase().indexOf(searchText) == -1) {
            $(note).hide();
          } else {
            $(note).show();
          }
        });
      }
    });

    $("#search-icon").on('click', function(evt){
      var searchText = $("#search").val().toLowerCase();
      if (searchText.length == 0) {
        $('.square').each(function(index, el) { $(el).show(); });
      }

      async.each($('.square'), function(note, err) {
        var text = $(note).find('.table-cell')[0];
        if (text.innerHTML.toLowerCase().indexOf(searchText) == -1) {
          $(note).hide();
        } else {
          $(note).show();
        }
      });
    });
  });
});

function shareFb(msg) {
  FB.ui({
    method: 'share',
    display: 'popup',
    href: 'http://projects.thedp.com/2018/02/valentines/lovenotes/',
    quote: msg,
  }, function(response){});
};
</script>
</body>
</html>
